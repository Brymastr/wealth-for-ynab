import { WorthDate } from '@/composables/types';
import { getDiffByMonth } from '../../src/composables/netWorth';

describe('getDiffByMonth', () => {
  test('real, complex example', () => {
    // prettier-ignore
    const exampleData: WorthDate[] = [
      { date: '2017-05-31', worth: -11600.36 },
      { date: '2017-06-30', worth: -9971.26, previous: { date: '2017-05-31', worth: -11600.36 } },
      { date: '2017-07-31', worth: -6293.78, previous: { date: '2017-06-30', worth: -9971.26 } },
      { date: '2017-08-31', worth: -3763.21, previous: { date: '2017-07-31', worth: -6293.78 } },
      { date: '2017-09-30', worth: -2022.91, previous: { date: '2017-08-31', worth: -3763.21 } },
      { date: '2017-10-31', worth: 1809.46, previous: { date: '2017-09-30', worth: -2022.91 } },
      { date: '2017-11-30', worth: -1762.09, previous: { date: '2017-10-31', worth: 1809.46 } },
      { date: '2017-12-31', worth: -836.84, previous: { date: '2017-11-30', worth: -1762.09 } },
      { date: '2018-01-31', worth: 4444.15, previous: { date: '2017-12-31', worth: -836.84 } },
      { date: '2018-02-28', worth: 7691.61, previous: { date: '2018-01-31', worth: 4444.15 } },
      { date: '2018-03-31', worth: 10323.81, previous: { date: '2018-02-28', worth: 7691.61 } },
      { date: '2018-04-30', worth: 10294.72, previous: { date: '2018-03-31', worth: 10323.81 } },
      { date: '2018-05-31', worth: 17463.01, previous: { date: '2018-04-30', worth: 10294.72 } },
      { date: '2018-06-30', worth: 16654.23, previous: { date: '2018-05-31', worth: 17463.01 } },
      { date: '2018-07-31', worth: 16029.32, previous: { date: '2018-06-30', worth: 16654.23 } },
      { date: '2018-08-31', worth: 18293.42, previous: { date: '2018-07-31', worth: 16029.32 } },
      { date: '2018-09-30', worth: 22378.01, previous: { date: '2018-08-31', worth: 18293.42 } },
      { date: '2018-10-31', worth: 21148.62, previous: { date: '2018-09-30', worth: 22378.01 } },
      { date: '2018-11-30', worth: 26373.51, previous: { date: '2018-10-31', worth: 21148.62 } },
      { date: '2018-12-31', worth: 26274.12, previous: { date: '2018-11-30', worth: 26373.51 } },
      { date: '2019-01-31', worth: 29335.46, previous: { date: '2018-12-31', worth: 26274.12 } },
      { date: '2019-02-28', worth: 37531.9, previous: { date: '2019-01-31', worth: 29335.46 } },
      { date: '2019-03-31', worth: 34418.38, previous: { date: '2019-02-28', worth: 37531.9 } },
      { date: '2019-04-30', worth: 41612.69, previous: { date: '2019-03-31', worth: 34418.38 } },
      { date: '2019-05-31', worth: 45480.08, previous: { date: '2019-04-30', worth: 41612.69 } },
      { date: '2019-06-30', worth: 45234.83, previous: { date: '2019-05-31', worth: 45480.08 } },
      { date: '2019-07-31', worth: 46036.9, previous: { date: '2019-06-30', worth: 45234.83 } },
      { date: '2019-08-31', worth: 58076.02, previous: { date: '2019-07-31', worth: 46036.9 } },
      { date: '2019-09-30', worth: 63189.29, previous: { date: '2019-08-31', worth: 58076.02 } },
      { date: '2019-10-31', worth: 64816.8, previous: { date: '2019-09-30', worth: 63189.29 } },
      { date: '2019-11-30', worth: 62874.75, previous: { date: '2019-10-31', worth: 64816.8 } },
      { date: '2019-12-31', worth: 66959.27, previous: { date: '2019-11-30', worth: 62874.75 } },
      { date: '2020-01-31', worth: 64920.65, previous: { date: '2019-12-31', worth: 66959.27 } },
      { date: '2020-02-29', worth: 67345.08, previous: { date: '2020-01-31', worth: 64920.65 } },
      { date: '2020-03-31', worth: 69712.31, previous: { date: '2020-02-29', worth: 67345.08 } },
      { date: '2020-04-30', worth: 68398.58, previous: { date: '2020-03-31', worth: 69712.31 } },
      { date: '2020-05-31', worth: 73472.38, previous: { date: '2020-04-30', worth: 68398.58 } },
      { date: '2020-06-30', worth: 78164, previous: { date: '2020-05-31', worth: 73472.38 } },
      { date: '2020-07-31', worth: 85808.52, previous: { date: '2020-06-30', worth: 78164 } },
      { date: '2020-08-31', worth: 90737.24, previous: { date: '2020-07-31', worth: 85808.52 } },
      { date: '2020-09-30', worth: 94774.8, previous: { date: '2020-08-31', worth: 90737.24 } },
      { date: '2020-10-31', worth: 92116.26, previous: { date: '2020-09-30', worth: 94774.8 } },
      { date: '2020-11-30', worth: 100354.65, previous: { date: '2020-10-31', worth: 92116.26 } },
      { date: '2020-12-31', worth: 111227.84, previous: { date: '2020-11-30', worth: 100354.65 } },
      { date: '2021-01-31', worth: 117723.09, previous: { date: '2020-12-31', worth: 111227.84 } },
      { date: '2021-02-28', worth: 125256.17, previous: { date: '2021-01-31', worth: 117723.09 } },
      { date: '2021-03-31', worth: 133766.32, previous: { date: '2021-02-28', worth: 125256.17 } },
      { date: '2021-04-30', worth: 141152.07, previous: { date: '2021-03-31', worth: 133766.32 } },
    ];

    const expected = [
      3200, // Jan (4444.15 - -836.84) + (29335.46 - 26274.12) + (64920.65 - 66959.27) + (117723.09 - 111227.84)   = 3199.74
      5350, // Feb (7691.61 - 4444.15) + (37531.9 - 29335.46) + (67345.08 - 64920.65) + (125256.17 - 117723.09)    = 5350.3525
      2599, // Mar (10323.81 - 7691.61) + (34418.38 - 37531.9) + (69712.31 - 67345.08) + (133766.32 - 125256.17)   = 2599.015
      3309, // Apr (10294.72 - 10323.81) + (41612.69 - 34418.38) + (68398.58 - 69712.31) + (141152.07 - 133766.32) = 3309.31
      1127, // May (-11600.36 - 0) + (17463.01 - 10294.72) + (45480.08 - 41612.69) + (73472.38 - 73472.38)         = 1127.28
      1317, // Jun (-9971.26 - -11600.36) + (16654.23 - 17463.01) + (45234.83 - 45480.08) + (78164 - 73472.38)     = 1316.6725
      2875, // Jul (-6293.78 - -9971.26) + (16029.32 - 16654.23) + (46036.9 - 45234.83) + (85808.52 - 78164)       = 2874.79
      5441, // Aug (-3763.21 - -6293.78) + (18293.42 - 16029.32) + (58076.02 - 46036.9) + (90737.24 - 85808.52)    = 5440.6275
      3744, // Sep (-2022.91 - -3763.21) + (22378.01 - 18293.42) + (63189.29 - 58076.02) + (94774.8 - 90737.24)    = 3743.93
      393, // Oct (1809.46 - -2022.91) + (21148.62 - 22378.01) + (64816.8 - 63189.29) + (92116.26 - 94774.8)       = 392.9875
      1987, // Nov (-1762.09 - 1809.46) + (26373.51 - 21148.62) + (62874.75 - 64816.8) + (100354.65 - 92116.26)    = 1987.42
      3946, // Dec (-836.84 - -1762.09) + (26274.12 - 26373.51) + (66959.27 - 62874.75) + (111227.84 - 100354.65)  = 3945.8925
    ];

    const actual = getDiffByMonth(exampleData);

    expect(actual).toStrictEqual(expected);
  });
});
